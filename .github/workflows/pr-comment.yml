name: Auto PR Lint/Type Status

on:
  pull_request:
    types: [opened, synchronize, labeled]
    branches: [main, dev, copilot/*]

jobs:
  comment-status:
    if: contains(github.event.pull_request.labels.*.name, 'lint-fix')
    runs-on: ubuntu-latest
    steps:
      - name: Checkout PR branch
        uses: actions/checkout@v4
      - name: Install deps
        run: npm install
      - name: Run lint
        run: npm run lint
      - name: Run type-check
        run: npm run type-check
      - name: Summarize diff
        run: |
          echo "Files changed: $(git diff --name-only ${{ github.event.pull_request.base.sha }} ${{ github.event.pull_request.head.sha }} | wc -l)" > pr_summary.txt
          echo "Lines added: $(git diff --numstat ${{ github.event.pull_request.base.sha }} ${{ github.event.pull_request.head.sha }} | awk '{added+=$1} END {print added}')" >> pr_summary.txt
          echo "Lines deleted: $(git diff --numstat ${{ github.event.pull_request.base.sha }} ${{ github.event.pull_request.head.sha }} | awk '{deleted+=$2} END {print deleted}')" >> pr_summary.txt
      - name: Post PR comment
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const summary = fs.readFileSync('pr_summary.txt', 'utf8');
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `
### ğŸ”„ Automated Lint/Type PR Status

**Lint:** ${{ job.status == 'success' ? 'âœ… Passed' : 'âŒ Failed' }}
**Type Check:** ${{ job.status == 'success' ? 'âœ… Passed' : 'âŒ Failed' }}

${summary}

**Tracking:**  
- [COPILOT_AGENTS_LINT_FIXES.md](../../COPILOT_AGENTS_LINT_FIXES.md)
- See PR for details and next steps.
`
            })
